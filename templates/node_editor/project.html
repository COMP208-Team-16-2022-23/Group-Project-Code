{% extends 'base.html' %}

{% block title %}Data Analysis{% endblock %}

{% block content %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/baklavajs/dist/index.css">

    <div style="width:100vw;height:100vh">
        <div id="editor"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/baklavajs/dist/index.js"></script>
    <script src="/static/js/DataSourceNode.js"></script>
    <script src="/static/js/DataProcessingNode.js"></script>
    <script src="/static/js/NormalizationNode.js"></script>

    <script>
        forms = document.getElementsByTagName("form");
        window.addEventListener('submit', function(event) {
            event.preventDefault();    // prevent page from refreshing
            const formData = new FormData(forms);  // grab the data inside the form fields
            fetch('/', {   // assuming the backend is hosted on the same server
                method: 'POST',
                body: formData,
            }).then(function(response) {
                // do something with the response if needed.
                // If you want the table to be built only after the backend handles the request and replies, call buildTable() here.
            });
        });
    </script>

    <script>
        const datasets = {{ my_data|safe }};
        const processing = {{ processing_cfg|safe }};
        const process_url =  "/node_editor/processing";
        
        
        const plugin = BaklavaJS.createBaklava(document.getElementById("editor"));
        const editor = plugin.editor;
        const viewPlugin = new BaklavaJS.PluginRendererVue.ViewPlugin();
        const engine = new BaklavaJS.PluginEngine.Engine(true);
        const interface = new BaklavaJS.PluginInterfaceTypes.InterfaceTypePlugin();
        
        editor.use(viewPlugin);
        editor.use(engine);
        editor.use(interface)
        editor.use(new BaklavaJS.PluginOptionsVue.OptionPlugin());
        
        editor.registerNodeType("Data", DataSourceNode);
        editor.registerNodeType("DataProcessing", DataProcessingNode);
        editor.registerNodeType("DisplayTest", TestNode);
        editor.registerNodeType("Normalization", NormalizationNode);
        
    </script>

{% endblock %}
